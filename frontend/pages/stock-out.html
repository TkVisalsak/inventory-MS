<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Request Overlay</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <link rel="stylesheet" href="/frontend/test/pos/style.css">

<div id="purchaseRequestsApp">
  <!-- Stats Cards -->
  <div class="stats-grid" id="statsGrid">
    <!-- Dynamic stats content will be injected here -->
  </div>

  <div class="content-section">
    <div class="section-header">
      <h2>Purchase Requests</h2>
      <p>Track and manage all purchase requests</p>
    </div>
    <div class="data-table-container">
      <table class="data-table" id="purchaseRequestsTable">
        <thead>
          <tr>
            <th>Request #</th>
            <th>Supplier</th>
            <th>Requested By</th>
            <th>Date</th>
            <th>Expected Delivery</th>
            <th>Priority</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="purchaseRequestsBody">
          <!-- Rows will be dynamically injected here -->
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="overlay" id="overlay" style="display:none;">
  <div class="modal">
    <!-- modal header -->
    <div class="modal-header">
      <h2>Create Purchase Request</h2>
      <button id="closeBtn">&times;</button>
    </div>
    <!-- modal content -->
    <form id="purchaseForm">
      <!-- form fields here -->
      <button type="submit">Submit</button>
    </form>
  </div>
</div>

    <!-- Overlay Background -->
    <div class="overlay" id="overlay">
        <!-- Modal Container -->
        <div class="modal">
            <!-- Header -->
            <div class="modal-header">
                <div>
                    <h2>Create Purchase Request</h2>
                    <p class="subtitle">Submit a new purchase request to suppliers</p>
                </div>
                <button class="close-btn" id="closeBtn">&times;</button>
            </div>

            <!-- Form Content -->
            <form class="modal-form" id="purchaseForm">
                <!-- Top Row Fields -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier">Supplier</label>
                        <select id="supplier" name="supplier">
                            <option value="">Select supplier</option>
                            <option value="supplier1">Supplier 1</option>
                            <option value="supplier2">Supplier 2</option>
                            <option value="supplier3">Supplier 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Priority</label>
                        <select id="priority" name="priority">
                            <option value="">Select priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                </div>

                <!-- Second Row Fields -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="delivery">Expected Delivery</label>
                        <input type="date" id="delivery" name="delivery" placeholder="mm/dd/yyyy">
                    </div>
                    <div class="form-group">
                        <label for="requestedBy">Requested By</label>
                        <input type="text" id="requestedBy" name="requestedBy" placeholder="Your name">
                    </div>
                </div>

                <!-- Products Section -->
                <div class="products-section">
                    <label class="section-label">Products</label>
                    <div class="products-table">
                        <div class="table-header">
                            <div class="col-product">Product</div>
                            <div class="col-quantity">Quantity</div>
                            <div class="col-price">Unit Price</div>
                            <div class="col-total">Total</div>
                        </div>
                        <div class="table-body" id="productsBody">
                            <div class="table-row">
                                <div class="col-product">
                                    <select name="product[]">
                                        <option value="">Select product</option>
                                        <option value="product1">Product 1</option>
                                        <option value="product2">Product 2</option>
                                        <option value="product3">Product 3</option>
                                    </select>
                                </div>
                                <div class="col-quantity">
                                    <input type="number" name="quantity[]" placeholder="0" min="0" step="1">
                                </div>
                                <div class="col-price">
                                    <input type="number" name="unitPrice[]" placeholder="0.00" min="0" step="0.01">
                                </div>
                                <div class="col-total">
                                    <input type="text" name="total[]" placeholder="0.00" readonly>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="add-product-btn" id="addProductBtn">
                            <span class="plus-icon">+</span>
                            Add Product
                        </button>
                    </div>
                </div>

                <!-- Notes Section -->
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" placeholder="Additional notes or requirements..." rows="4"></textarea>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="saveDraftBtn">Save as Draft</button>
                    <button type="submit" class="btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <script>document.addEventListener('DOMContentLoaded', function() {
    const overlay = document.getElementById('overlay');
    const closeBtn = document.getElementById('closeBtn');
    const addProductBtn = document.getElementById('addProductBtn');
    const productsBody = document.getElementById('productsBody');
    const form = document.getElementById('purchaseForm');
    const saveDraftBtn = document.getElementById('saveDraftBtn');

    // Close modal functionality
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', function(e) {
        if (e.target === overlay) {
            closeModal();
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });

    function closeModal() {
        overlay.style.display = 'none';
    }

    // Add product row functionality
    addProductBtn.addEventListener('click', function() {
        const newRow = document.createElement('div');
        newRow.className = 'table-row';
        newRow.innerHTML = `
            <div class="col-product">
                <select name="product[]">
                    <option value="">Select product</option>
                    <option value="product1">Product 1</option>
                    <option value="product2">Product 2</option>
                    <option value="product3">Product 3</option>
                </select>
            </div>
            <div class="col-quantity">
                <input type="number" name="quantity[]" placeholder="0" min="0" step="1">
            </div>
            <div class="col-price">
                <input type="number" name="unitPrice[]" placeholder="0.00" min="0" step="0.01">
            </div>
            <div class="col-total">
                <input type="text" name="total[]" placeholder="0.00" readonly>
            </div>
        `;
        productsBody.appendChild(newRow);
        
        // Add event listeners for calculation
        addCalculationListeners(newRow);
    });

    // Calculate total for each product row
    function addCalculationListeners(row) {
        const quantityInput = row.querySelector('input[name="quantity[]"]');
        const priceInput = row.querySelector('input[name="unitPrice[]"]');
        const totalInput = row.querySelector('input[name="total[]"]');

        function calculateTotal() {
            const quantity = parseFloat(quantityInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
            const total = quantity * price;
            totalInput.value = total.toFixed(2);
        }

        quantityInput.addEventListener('input', calculateTotal);
        priceInput.addEventListener('input', calculateTotal);
    }

    // Add calculation listeners to existing rows
    document.querySelectorAll('.table-row').forEach(addCalculationListeners);

    // Form submission
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Collect form data
        const formData = new FormData(form);
        const data = {};
        
        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
            if (data[key]) {
                if (Array.isArray(data[key])) {
                    data[key].push(value);
                } else {
                    data[key] = [data[key], value];
                }
            } else {
                data[key] = value;
            }
        }
        
        console.log('Form submitted:', data);
        alert('Purchase request submitted successfully!');
        closeModal();
    });

    // Save as draft
    saveDraftBtn.addEventListener('click', function() {
        const formData = new FormData(form);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            if (data[key]) {
                if (Array.isArray(data[key])) {
                    data[key].push(value);
                } else {
                    data[key] = [data[key], value];
                }
            } else {
                data[key] = value;
            }
        }
        
        console.log('Draft saved:', data);
        alert('Draft saved successfully!');
    });

    // Show modal on page load (for demo purposes)
    // overlay.style.display = 'flex';
});</script>
</body>
</html>
